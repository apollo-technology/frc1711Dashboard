<!DOCTYPE html>
<html>

<head>
    <title>frc1711 - Home</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="w3.css">
    <script src="sinch.js"></script>
    <script src="parse.js"></script>
</head>
<style>
body,
html {
    height: 100%
}

.bgimg {
    background-image: url('steamworks.png');
    min-height: 100%;
    background-position: center;
    background-size: cover;
}
</style>
<div id="loadingView" class="w3-modal">
    <div class="w3-modal-content">
        <div class="w3-container">
            <p>Signing you in.</p>
        </div>
    </div>
</div>
<div id="loginView" class="w3-modal">
    <div class="w3-modal-content w3-card-8 w3-animate-zoom" style="max-width:600px">
        <div class="w3-center">
            <br>
            <img src="frcIcon.png" alt="Avatar" style="width:30%" class="w3-circle w3-margin-top">
        </div>
        <div class="w3-container">
            <div class="w3-section">
                <label id="label"><b>Phone Number</b></label>
                <input class="w3-input w3-border w3-margin-bottom" type="text" placeholder="Enter Phone Number" id="phoneField" required>
                <button class="w3-btn-block w3-blue w3-section w3-padding" id="loginButton" type="submit" onclick="loginAction()">Login</button>
            </div>
        </div>
    </div>
</div>

<body class="w3-white">
    <ul class="w3-navbar w3-light-grey">
        <li><a href="index.html" class="w3-blue">Home</a></li>
        <li><a href="groundscouting.html">Ground Scouting</a></li>
        <li><a href="scouting.html">Scouting</a></li>
        <li class="w3-dropdown-hover">
            <a href="">More</a>
            <div class="w3-dropdown-content w3-white w3-card-4">
                <a href="http://www.raptors1711.com">View 1711 Main Website</a>
                <a href="https://www.thebluealliance.com/">View The Blue Alliance</a>
                <a href="settings.html"/>Settings</a>
            </div>
        </li>
        <li class="w3-right w3-padding-right"><img src="raptorlogo.png" style="width:280px;height:38px;" /></li>
    </ul>
    <div class="bgimg w3-display-container w3-animate-opacity w3-text-white">
        <div class="w3-display-middle" style="background-color: rgba(0,0,0,.5);border-radius: 40px;">
            <h1 class="w3-jumbo w3-center"><b>FRC 1711 Dashboard</b></h1>
            <hr class="w3-border-grey" style="margin:auto;width:40%">
            <center>
                <p class="w3-large w3-center" style="width: 60%;">Welcome to FRC 1711's Scouting Dashboard. Here, you and your team can access anaylytics for all scouting information you and your teamates collect.</p>
            </center>
        </div>
    </div>
</body>
<script type="text/javascript">
Parse.initialize("frc1711", "nil");
Parse.serverURL = 'http://api.apollotechnology.co:1002';

var currentUser = Parse.User.current();
if (!currentUser) {
    document.getElementById('loginView').style.display = 'block';
}

function loginAction() {
    var sinchClient = new SinchClient({
        applicationKey: "e53ee320-4d09-49f2-a443-b9194b8e49fa"
    })
    var phoneField = document.getElementById("phoneField");
    var givenNumber = phoneField.value;
    var verification = sinchClient.createSmsVerification(phoneField.value);
    verification.initiate().then(function(successInfo) {
        phoneField.placeholder = "Code";
        phoneField.value = "";
        document.getElementById("label").innerHTML = "Enter Code"
        var loginButton = document.getElementById("loginButton");
        loginButton.onclick = function() {
            var code = phoneField.value;
            verification.verify(code).then(function(successInfo) {
                document.getElementById('loginView').style.display = 'none';
                document.getElementById('loadingView').style.display = 'block';
                Parse.User.logIn(givenNumber, "raptors", {
                    success: function(user) {
                        // Do stuff after successful login.
                        document.getElementById('loadingView').style.display = 'none';
                    },
                    error: function(user, error) {
                        // The login failed. Check error to see why.
                    }
                });
            }).fail(function(errorInfo) {
                console.error("NO");
            });
        }
    }).fail(function(errorInfo) {
        // Act on error
    });
}
</script>

</html>
